<!DOCTYPE html>
<html>
  <head> 
    <meta charset="utf-8" />
    <link href="favicon.ico" rel="icon" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="css/game.css" />
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/konva.min.js"></script>
    <script src="js/magic.js"></script> 
    <title>youkaiCG</title>
  </head>
  <body>
    <div id="main">
      <div class="previa">
        <img id="cadet" src="">
      </div>   
      <div id="hand" class="mao">
				<button id="redbutt" onclick="startGame(1)">Go first</button>
				<button id="redbutt2" onclick="startGame(2)">Go second</button>
        <span>Cards in hand: </span><span id="hand_count">0</span>
        <br>
      </div>
      <div id="container"></div>
			<div id="menu" class="manu">
				<div>
					<button id="susp-button">Suspend</button>
					<button id="delete-button">Trash</button>
				</div>
			</div>
			<span id="phase3" class="gameflow">Breeding Phase</span>
			<span id="phase4" class="gameflow">Main Phase</span>
			<span id="phase5" class="gameflow">End of the Turn</span>
      <img id="egg_cover" src="assets/sleeves/294b7c16a5912f7000a353142e4ac566.jpeg" onclick="breed()">
			<button id="wonka" onclick="showDeck()">Look 1</button>
      <img id="deck_cover" src="assets/sleeves/werfsfe.jpg" onclick="draw()">
			<img id="trash" src="" onclick="showTrash()">
			<button id="willy" onclick="showSec()">Look all</button>
      <img class="security" id="sec1" src="assets/sleeves/werfsfe.jpg" onclick="secCheck()">
      <img class="security" id="sec2" src="assets/sleeves/werfsfe.jpg" onclick="secCheck()">
      <img class="security" id="sec3" src="assets/sleeves/werfsfe.jpg" onclick="secCheck()">
      <img class="security" id="sec4" src="assets/sleeves/werfsfe.jpg" onclick="secCheck()">
      <img class="security" id="sec5" src="assets/sleeves/werfsfe.jpg" onclick="secCheck()">
			<span class="conut" id="sec_count">0</span>
      <span class="conut" id="egg_count">4</span>
      <span class="conut" id="deck_count">50</span>
      <span class="conut" id="trash_count">0</span>
			<div id="showcase">
				<img id="exit" src="img/close.png" onclick="closeShow()">
				<div id="inside"></div>
			</div>
      <img id="marker" src="assets/counters/smile.png">
			<div id="comando">
				<button id="saturn" onclick="startTurn(this)" disabled>Start turn</button>
				<button onclick="shuffle(deck_stack)" hidden>Shuffle Deck</button>
				<button onclick="gainMemo()">Gain Memory</button> 
				<input type="number" id="tnt" name="tnt" min="1" max="20" size="4" value="2" />
				<button onclick="payCost()">Pay Cost</button> 
				<button id="next" onclick="nextPhase()">Next Phase</button>
				<span class="memo">Memory: </span><span class="memo" id="memtxt">0</span>				
			</div>
    </div>
  </body>
</html>
<script>
  $(".previa").hide();
	const regex = /(?<=cards)(.*)(?=.webp)/g;
	let currentShape;
  var width = 1200;
  var height = 700;
  var stage = new Konva.Stage({
    container: 'container',
    width: width,
    height: height,
  });
  var rectX = stage.width() / 2 - 50;
  var rectY = stage.height() / 2 - 25;
  setCenter();
  $("#hand").children('img').hover(function(){
    $("#cadet").attr('src',$(this).attr('src')); 
    $(".previa").show();
  }, function(){
    $(".previa").hide();
  });
	var menuNode = document.getElementById('menu');  
  window.addEventListener('click', () => {
    menuNode.style.display = 'none';
  });
	document.getElementById('delete-button').addEventListener('click', () => {
		currentShape.destroy();
		//layer.draw();
		let ima = currentShape.attrs.image.src;
		document.getElementById("trash").src = ima;
		let trator = ima.match(regex);
		trash_stack.push(trator);
		trash = trash + 1;
		document.getElementById("trash_count").innerHTML = trash;
		audio3.play();
	});
	stage.on('contextmenu', function (e) {
		// prevent default behavior
		e.evt.preventDefault();
		if (e.target === stage) {
			// if we are on empty place of the stage we will do nothing
			return;
		}
		currentShape = e.target;
		//console.log(currentShape);
		// show menu
		menuNode.style.display = 'initial';
		var containerRect = stage.container().getBoundingClientRect();
		menuNode.style.top = containerRect.top + stage.getPointerPosition().y + 4 + 'px';
		menuNode.style.left = containerRect.left + stage.getPointerPosition().x + 4 + 'px';
	});
</script>